<?php
 $datetime = new DateTime(null, new DateTimeZone('Asia/Ho_Chi_Minh')); 
 $y=$datetime->format('Y');          
 $m=$datetime->format('m');
 $d=$datetime->format('d'); 
?>
<style type="text/css">
    #nha-cung-cap-search-result{ cursor:pointer;}
    #ma-hang-search-result{ cursor:pointer;}
    @media print {
        .table{width: 790px; font-size: 13px; margin-top: -60px}
        .tb{width: 97%;}
        .td{width: 90px;}  
        table td{padding: 5px;}      
                
        .row{display: none;}
        .h5a-container{display: none;}
        .tbIn{display: block;}
        #formNhapHang{display: none;}
    }
</style>

<script>   
    kiemTracheckbox = function(){
        var tam=document.getElementById("loaiGia").checked;
        if(tam)
        {
            // có check thì hiển thị và giá trị bằng 1
            document.getElementById("loaiGia").value=1;
            document.getElementById("trGiaBia").hidden=false;
            document.getElementById("trChiecKhau").hidden=false;
            document.getElementById('trGiaNhap').hidden=true;
        }
        else
        {
            // không có check thì ẩn và giá trị bằng 0
            document.getElementById("loaiGia").value=0;
            document.getElementById("trGiaBia").hidden=true;
            document.getElementById("trChiecKhau").hidden=true;
            document.getElementById('trGiaNhap').hidden=false;
        }
        return true;
    }
</script>
<div  class="tbIn" hidden="true">
    <table class="table">
        <tr style="text-align: -moz-center; border-style:hidden">
            <td>
                <table border="0" class="tb">
                    <tr>
                        <td style="width:60%">
                            <b>
                                CTY CP SÁCH &amp; TB TRƯỜNG HỌC TRÀ VINH</br>
                                3A Trưng Nữ Vương Phường 1 TP.Trà Vinh</br>
                                Mã số thuế: 2100 290 521
                            </b>
                        </td>
                        <td style="text-align:center">
                            <b>Mẫ số: 01 - TT</b></br>
                            (Ban hành theo QĐ số: 15/2006/QĐ-BTC ngày 20/3/2006 của Bộ trưởng BTC)
                        </td>            
                    </tr>
                </table>

                <table border="0" style="width:65%; margin-left:220px"  class="tb">
                    <tr>
                        <td style="width:50%; padding:0px 0px 0px 30px; font-size:16px; font-weight:bold">PHIẾU NHẬP KHO</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td style="padding:0px;">Ngày <?php echo $d;?> tháng <?php echo $m;?> năm <?php echo $y;?></td>
                        <td style="padding:0px;">
                            Nợ: ........................................
                        </td>
                    </tr>
                    <tr>
                        <td style="padding:0px;">
                            Số: ........................................
                        </td>
                        <td style="padding:0px;">
                            Có: ........................................
                        </td>
                    </tr>
                </table>

                <table border="0"  class="tb">
                    <tr>
                        <td colspan="4">
                            - Họ và tên người giao:.............................................................................................................................................
                        </td>
                    </tr>
                    <tr>
                        <td style="width:200px">
                            - Theo.....................
                        </td>
                        <td style="width:100px">
                            số....................
                        </td>
                        <td style="width:215px">
                            ngày........tháng........năm 20....
                        </td>
                        <td>                            
                            của...............................................
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">                        
                            Nhập tại kho:........................................
                        </td>                    
                        <td colspan="2">
                            Địa điểm............................................................................................
                        </td>
                    </tr>
                    <tr><td></td></tr>
                </table>

                <table border="1" id="tbSanPham">
                    <tr style="text-align:center">
                        <td rowspan="2" style="width:45px">STT</td>
                        <td rowspan="2">Tên, nhãn hiệu quy cách, phẩm chất vật tư, dụng cụ sản phẩm, hàng hóa</td>
                        <td rowspan="2" class="td">Mã số</td>
                        <td rowspan="2" class="td">Đơn vị tính</td>
                        <td colspan="2" style="width:300px">Số lượng</td>
                        <td rowspan="2" class="td">Đơn giá</td>
                        <td rowspan="2" class="td">Thành tiền</br>(vnđ)</td>
                    </tr>
                    <tr style="text-align:center">
                        <td>Theo chứng từ</td>
                        <td>Thực nhập</td>
                    </tr>
                    <tr style="text-align:center">
                        <td>A</td>
                        <td>B</td>
                        <td>C</td>
                        <td>D</td>
                        <td>1</td>
                        <td>2</td>
                        <td>3</td>
                        <td>4</td>
                    </tr>                    
                </table>
            </td>
        </tr>
        <tr style="border-style:hidden">
            <td style="padding-left:20px">- Tổng số tiền (viết bằng chữ): <span id="tongSoTien"></span>&nbsp;đồng</td>
        </tr>
        <tr style="border-style:hidden">
            <td style="padding-left:20px">
                - Số chứng từ gốc kèm theo: .....................................................................................................................................
            </td>
        </tr>
        <tr style="text-align: -moz-center">
            <td>
                <table border="0" class="tb" style="width:100%;">
                    <tr>
                        <td colspan="4" style="text-align:right">Ngày <?php echo $d;?> tháng <?php echo $m;?> năm <?php echo $y;?></td>
                    </tr>
                    <tr style="text-align: center;">
                        <td>
                            Người lập phiếu</br>(Ký, họ tên)
                        </td>
                        <td>
                            Người giao hàng</br>(Ký, họ tên)
                        </td>
                        <td>
                            Thủ kho</br>(Ký, họ tên)
                        </td>
                        <td>
                            Kế toán trưởng<br>(Hoặc bộ phận có nhu cầu nhập)</br>(Ký, họ tên)
                        </td>
                    </tr>
                    <tr>
                        <td style="height:100px"></td>
                    </tr>                    
                </table>
            </td>
        </tr>
    </table>
</div>
<?php
     
     $this->headTitle('Nhập hàng');
     $form->setAttribute('action', $this->url('hang_hoa/crud', array('action' => 'nhapHang')));
     $form->setAttribute('role','form');
     $form->setAttribute('id','formNhapHang');
     $form->setAttribute('class','form-horizontal');
     $form->prepare();
     echo $this->form()->openTag($form);
     echo $this->formHidden($form->get('idSanPham'));
     echo $this->formHidden($form->get('donViTinh'));
     echo $this->formHidden($form->get('idNhaCungCap'));
     echo $this->formHidden($form->get('phieu-nhap')->get('idPhieuNhap'));
     $form->get('phieu-nhap')->get('maPhieuNhap')->setAttribute('value','1114-9999');
     echo $this->formHidden($form->get('phieu-nhap')->get('maPhieuNhap'));
     $form->get('phieu-nhap')->get('ngayNhap')->setAttribute('value',Date('Y-m-d'));
     echo $this->formHidden($form->get('phieu-nhap')->get('ngayNhap'));     
     echo $this->formHidden($form->get('phieu-nhap')->get('idDoiTac')->get('idDoiTac'));
     echo $this->formHidden($form->get('phieu-nhap')->get('idUserNv')->get('userId'));
     echo $this->formHidden($form->get('phieu-nhap')->get('status'));
     
?>
<div class="row">
    <div class="col-md-2">
        <div class="h5a-sidebar affix">
            <span class="breadcrumb row">
                <a href="<?php echo $this->url('hang_hoa/crud',array('action'=>'index'));?>">/ Kho</a>
                <a href="<?php echo $this->url('hang_hoa/crud',array('action'=>'hangHoa'));?>">/ Hàng hóa</a>
                 / Nhập hàng /
            </span>
            <ul class="nav h5a-sidenav nav-list accordion">                        
                <li>
                    <a href="<?php echo $this->url('hang_hoa/crud',array('action'=>'hangHoa'));?>">
                        <i class="fa fa-cubes"></i> Danh sách hàng
                    </a>
                </li>
                <li>
                    <a href="<?php echo $this->url('hang_hoa/crud',array('action'=>'nhapHang'));?>">
                        <i class="fa fa-download"></i> Nhập hàng
                    </a>
                </li>
                <li>
                    <a href="<?php echo $this->url('hang_hoa/crud',array('action'=>'xuatHang'));?>">
                        <i class="fa fa-upload"></i> Xuất hàng
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="col-md-10" role="main">
        <div class="h5a-docs-section">
            <div class="page-header">
                <div class="row">                    
                    <div class="col-sm-6">
                        <h1>Nhập hàng</h1>
                    </div>
                    <div class="col-sm-6">                                
                    </div>
                </div>
                <?php
                    $flash=$this->flashMessenger();
                    $flash->setMessageOpenFormat('<div%s>
                     <button type="button" id="btFm" class="close" data-dismiss="alert" aria-hidden="true">
                         &times;
                     </button>
                     <ul><li>')
                     ->setMessageSeparatorString('</li><li>')
                     ->setMessageCloseString('</li></ul></div>');

                     $error=$flash->render('error',   array('alert', 'alert-dismissable', 'alert-danger'));
                     echo $error;

                     $info=$flash->render('info',    array('alert', 'alert-dismissable', 'alert-info'));
                     echo $info;

                     $default=$flash->render('default', array('alert', 'alert-dismissable', 'alert-warning'));
                     echo $default;

                     $success=$flash->render('success', array('alert', 'alert-dismissable', 'alert-success'));
                     echo $success;                     
                    if($error||$success||$info||$default)
                    {
                        echo '
                        <script type="text/javascript">
                            setTimeout(function(){
                                document.getElementById("btFm").click();
                            },5000);
                        </script>';                        
                    }
                ?>
            </div>                 
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 right" for="form-field-1">Mã vạch</label>
                    <div class="col-sm-7">                                    
                        <?php
                            echo $this->formElement($form->get('maHang'));
                        ?>
                    </div>
                    <div id="ma-hang-search-result"></div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 right" for="form-field-2">Tên hàng</label>
                    <div class="col-sm-7">                                    
                        <?php
                            echo $this->formElement($form->get('tenHang'));
                        ?>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-4 right" for="form-field-1">Nhà cung cấp</label>
                    <div class="col-sm-7">
                        <?php
                            echo $this->formElement($form->get('nhaCungCap'));
                        ?>
                    </div>
                    <div id="nha-cung-cap-search-result"></div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 right" for="form-field-3">Số lượng</label>
                    <div class="col-sm-7">                                    
                        <?php
                            echo $this->formElement($form->get('soLuong'));
                        ?>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 right" for="form-field-4"></label>
                    <div class="col-sm-7"> 
                         <?php                                                                 
                            $loaiGia=$form->get('loaiGia');
                            $loaiGia->setAttribute('id','loaiGia');
                            $loaiGia->setAttribute('onChange','return kiemTracheckbox();');
                            echo $this->formElement($loaiGia);                                               
                        ?>                                   
                       <!--  <input type="checkbox" value="0" onChange="return kiemTracheckbox();" name="loaiChiecKhau" id="loaiChiecKhau"> -->
                        Sản phẩm thuộc loại có giá bìa
                    </div>
                </div>
                <div class="form-group" id="trGiaNhap">
                    <label class="col-sm-4 right" for="form-field-4">Giá nhập</label>
                    <div class="col-sm-7">                                    
                        <?php
                            $form->get('giaNhap')->setAttribute('value','0');
                            $form->get('giaNhap')->setAttribute('id','giaNhap');
                            $form->get('giaNhap')->setAttribute('class','h5a-input form-control input-sm');
                            echo $this->formElement($form->get('giaNhap'));
                        ?>
                    </div>
                </div>
                <div class="form-group" id="trChiecKhau" hidden="true">
                    <label class="col-sm-4 right" for="form-field-4">Chiếc khấu (%)</label>
                    <div class="col-sm-7">                                    
                        <?php

                            $form->get('chiecKhau')->setAttribute('value','0');
                            $form->get('chiecKhau')->setAttribute('id','chiecKhau');
                            $form->get('chiecKhau')->setAttribute('class','h5a-input form-control input-sm');
                            echo $this->formElement($form->get('chiecKhau'));
                        ?>
                    </div>
                </div>
                <div class="form-group" id="trGiaBia" hidden="true">
                    <label class="col-sm-4 right" for="form-field-4">Giá bìa</label>
                    <div class="col-sm-7">                                    
                        <?php
                            $form->get('giaBia')->setAttribute('value','0');
                            $form->get('giaBia')->setAttribute('id','giaBia');
                            $form->get('giaBia')->setAttribute('class','h5a-input form-control input-sm');
                            echo $this->formElement($form->get('giaBia'));
                        ?>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="col-sm-10 col-sm-offset-1">
                        <button type="button" id="btnNhapHang" class="btn h5a-btn btn-primary full">Nhập hàng</button>
                    </div>
                </div>
            </div>
        </div>                
    </div>
</div>

<div class="h5a-container">
    <div class="row">
        <div class="col-md-2">
        </div>
        <h2 hidden="true" class="in">CHI TIẾT PHIẾU NHẬP</h2>
        
        
        <div class="col-md-10">
            <h1>Danh sách nhập</h1>
            <div class="box">
                <table id="tbNhapHang" class="invoice pricelist bottom20">
                    <thead>
                        <th>Sản phẩm</th>
                        <th>Đơn vị tính</th>
                        <th>Số lượng</th>
                        <th>Giá nhập</th>
                        <th class="an">Hủy</th>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>            
            <div class="page-footer">                
                <div class="col-sm-6">
                    <div class="col-sm-6 col-sm-offset-1">
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group">
                        <div class="col-sm-10 col-sm-offset-1">
                            <button type="submit" class="btn h5a-btn btn-primary full" onclick="return luuNhapHangFunction();">Lưu</button>
                        </div>
                    </div>
                </div>
            </div> 
        </div>
    </div>
</div>

<?php
    echo $this->form()->closeTag();
?>   
    <!-- FormatNumber -->
    <script src="<?php echo $this->basePath();?>/js/formatnumber.js"></script>

    <!-- convernumbertostring -->
    <script src="<?php echo $this->basePath();?>/js/convernumbertostring.js"></script>

    <!-- jQuery -->
    <script src="<?php echo $this->basePath();?>/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="<?php echo $this->basePath();?>/js/bootstrap.min.js"></script>

    <!-- DataTables JavaScript -->
    <script src="<?php echo $this->basePath();?>/js/plugins/dataTables/jquery.dataTables.js"></script>

    <!-- Page-Level Demo Scripts - Tables - Use for reference -->
    <script>    
    $(document).ready(function() 
    {
        $('#dataTables-example').dataTable({
            "pagingType": "simple",
            "bPaginate": true,
            "bLengthChange": true,
            "bFilter": true,
            "bInfo": true,
            "bAutoWidth": true
        });
        $('#loaiGia').val(0);
        var i=0;
        
        $('#btnNhapHang').click(function(){
            var idSanPham=$('#idSanPham').val();
            var maHang=$('#idMaHang').val();
            var tenHang=$('#tenHang').val();
            var soLuong=$('#soLuong').val(); 
            var giaNhap=$('#giaNhap').val();
            var donViTinh=$('#donViTinh').val();
            var idNhaCungCap=$('#idNhaCungCap').val();
            var nhaCungCap=$('#nhaCungCap').val();
            var loaiGia=$('#loaiGia').val();
            var giaBia=$('#giaBia').val();
            var chietKhau=$('#chiecKhau').val();

            if(loaiGia==1)
            {
                if(giaBia==0||giaBia==''||giaBia==null||
                   chietKhau==0||chietKhau==''||chietKhau==null)
                {
                    alert('Vui lòng điền đầy đủ thông tin');
                    return false;
                }
                var loiNhuan=(parseFloat(giaBia)*parseFloat(chietKhau))/100;   
                giaNhap=parseFloat(giaBia)-parseFloat(loiNhuan);

            }
            else
            {
                chietKhau=0;
                giaBia=0;
            }

            if(idSanPham==''||maHang==''||tenHang==''||donViTinh==''||soLuong==''||giaNhap==''||nhaCungCap==''||idNhaCungCap==''||idSanPham==null||maHang==null||tenHang==null||donViTinh==null||soLuong==null||giaNhap==null||nhaCungCap==null||idNhaCungCap==null)
            {
                alert('Thông tin không đầy đủ hoặc không chính xác');
                return false;
            }

            var soDong = $('#tbNhapHang > tbody > tr').length;            
            var template = '<tr class="price">'+
                '<td>'+tenHang+'</td>'+
                '<td>'+donViTinh+'</td>'+
                '<td>'+
                    '<input type="hidden" name="phieu-nhap&#x5B;ctPhieuNhaps&#x5D;&#x5B;__index__&#x5D;&#x5B;idSanPham&#x5D;&#x5B;idSanPham&#x5D;" value="'+idSanPham+'">'+'<span hidden="true" class="maSanPham">'+maHang+'</span>'+
                    '<input type="hidden" name="phieu-nhap&#x5B;ctPhieuNhaps&#x5D;&#x5B;__index__&#x5D;&#x5B;soLuong&#x5D;" value="'+soLuong+'">'+
                    '<span class="soLuong">'+soLuong+'</span>'+
                '</td>'+
                '<td>'+
                    '<input type="hidden" name="phieu-nhap&#x5B;ctPhieuNhaps&#x5D;&#x5B;__index__&#x5D;&#x5B;giaNhap&#x5D;" value="'+giaNhap+'">'+
                    '<span class="giaNhap">'+giaNhap+'</span>'+
                    '<input type="hidden" name="phieu-nhap&#x5B;ctPhieuNhaps&#x5D;&#x5B;__index__&#x5D;&#x5B;idSanPham&#x5D;&#x5B;loaiGia&#x5D;" value="'+loaiGia+'">'+
                    '<input type="hidden" name="phieu-nhap&#x5B;ctPhieuNhaps&#x5D;&#x5B;__index__&#x5D;&#x5B;idSanPham&#x5D;&#x5B;giaBia&#x5D;" value="'+giaBia+'">'+
                    '<input type="hidden" name="phieu-nhap&#x5B;ctPhieuNhaps&#x5D;&#x5B;__index__&#x5D;&#x5B;idSanPham&#x5D;&#x5B;chiecKhau&#x5D;" value="'+chietKhau+'">'+
                    
                '</td>'+
                '<td style="text-align:left;" class="an">'+
                    '<a class="btnHuy"><img src="<?php echo $this->basePath(); ?>/img/delete.png" width="30px" height="30px"></a>'+
                '</td>'+                
                '</tr>';

                $('input[name="phieu-nhap[idDoiTac][idDoiTac]"]').val(idNhaCungCap);
                $('input[name="phieu-nhap[idUserNv][userId]"]').val(1);

            template = template.replace(/__index__/g, soDong);
            $('#tbNhapHang tbody').append(template);
            return false;
        });

    //Hiển thị, chọn sản phẩm
        var xhr;
        var xhr1;    
        $('#idMaHang').keyup(function(){
            var maHang=$(this).val();            
            if(xhr && xhr.readyState != 4){
                xhr.abort(); //huy lenh ajax truoc do
            }
            if(maHang==''||maHang==null)
            {                
                $('#tenHang').val('');
            }

           xhr = $.ajax({
                url:'<?php echo $this->url('hang_hoa/crud', array('action'=>'searchSanPham')); ?>',
                type:'POST',
                dataType:'json',
                data:{
                    'maHang':maHang
                },

                success:function(data){                
                    $.each(data, function(key,val){
                        $('#ma-hang-search-result').empty(); //lam rong khung ket qua

                        var pos = $('#idMaHang').position(); //lấy tọa độ của ô mã sản phẩm
                        $('#ma-hang-search-result').css({
                            position:'absolute',
                            top:pos.top + 35,
                            left:pos.left+177,
                            'z-index': 100 // đặt search-result lên layout ngoài nhất
                        });

                        $.each(data, function(key, val){
                            $('#ma-hang-search-result').append('<div class="list-group-item"><span class="hide">'+val.idSanPham+'</span><span>'+val.maHang+'</span><span class="hide">'+val.tenSanPham+'</span><span class="hide">'+val.giaNhap+'</span><span class="hide">'+val.donViTinh+'</span><span class="hide">'+val.loaiGia+'</span><span class="hide">'+val.giaBia+'</span><span class="hide">'+val.chietKhau+'</span></div>');
                            // thêm một dòng vào search result, mỗi một dòng là 1 sản phẩm
                        })
                    });
                }
            });
            return false;
        });

        $('#ma-hang-search-result').on('click', '.list-group-item', function(){
            var id = $(this).find('span:eq(0)').text();
            var ma = $(this).find('span:eq(1)').text();
            var ten = $(this).find('span:eq(2)').text();            
            var giaNhap = $(this).find('span:eq(3)').text();
            var donViTinh = $(this).find('span:eq(4)').text();   
            var loaiGia=$(this).find('span:eq(5)').text();   
            var giaBia=$(this).find('span:eq(6)').text();   
            var chietKhau=$(this).find('span:eq(7)').text(); 

            $('#idSanPham').val(id);
            $('#idMaHang').val(ma);
            $('#tenHang').val(ten);
            $('#giaNhap').val(giaNhap);
            $('#donViTinh').val(donViTinh);
            $('#loaiGia').val(loaiGia);
            $('#giaBia').val(giaBia);
            $('#chiecKhau').val(chietKhau);
            if(parseInt(loaiGia)==1)
            {
                $("#loaiGia").prop("checked", true);
                $("#loaiGia").val(1);
                kiemTracheckbox();
            }
            else
            {
                $("#loaiGia").prop("checked", false);
                $("#loaiGia").val(0);
                kiemTracheckbox();
            }
            
            $('#ma-hang-search-result').empty();
        });
    //./Hiển thị, chọn sản phẩm

    //Hiển thị, chọn nhà cung cấp
        $('#nhaCungCap').keyup(function()
        {

            if($('#idNhaCungCap').val()=='')
            {
                $('#nha-cung-cap-search-result').empty();
            }
            var nhaCungCap=$(this).val();            
            if(xhr1 && xhr1.readyState != 4){
                xhr1.abort(); //huy lenh ajax truoc do
            }

            xhr1 = $.ajax({
                url:'<?php echo $this->url('hang_hoa/crud', array('action'=>'searchNhaCungCap')); ?>',
                type:'POST',
                dataType:'json',
                data:{
                    'nhaCungCap':nhaCungCap
                },

                success:function(data){  
                             
                    $.each(data, function(key,val){
                        $('#nha-cung-cap-search-result').empty(); //lam rong khung ket qua

                        var pos = $('#nhaCungCap').position(); //lấy tọa độ của ô mã sản phẩm
                        $('#nha-cung-cap-search-result').css({
                            position:'absolute',
                            top:pos.top + 109,
                            left:pos.left+177,
                            'z-index': 100 // đặt search-result lên layout ngoài nhất
                        });

                        $.each(data, function(key, val){
                            $('#nha-cung-cap-search-result').append('<div class="list-group-item"><span class="hide">'+val.idDoiTac+'</span><span>'+val.hoTen+'</span><span class="hide">'+val.diaChi+'</span></div>');
                        })
                    });
                }
            });            
            return false;
        });

        $('#nha-cung-cap-search-result').on('click', '.list-group-item', function()
            {
                $('#tbNhapHang > tbody > tr').remove();
                var idDoiTac = $(this).find('span:eq(0)').text();
                var hoTen = $(this).find('span:eq(1)').text();
                var diaChi = $(this).find('span:eq(2)').text();
                $('#idNhaCungCap').val(idDoiTac); 
                $('#nhaCungCap').val(hoTen);      
                $('#tenNCC').text(hoTen);     
                $('#diaChiNCC').text(diaChi);      

                $('#nha-cung-cap-search-result').empty();
            });    
    //./Hiển thị, chọn nhà cung cấp

    });

    $(document).ready(function(){
      $(document).on('click', '.btnHuy', function(){        
        $(this).closest('tr').remove();        
        return false;
      });
    });
    </script>

    <script>

        luuNhapHangFunction=function()
        {            
            var soDong = $('#tbNhapHang > tbody > tr').length; 
            if(soDong==0)
            {
                alert('Không có sản phẩm trong danh sách nhập!');
                return false;
            }
            else
            {
                var soLuong=new Array();
                var donGia=new Array();                
                var maSanPham=new Array();
                var thanhTien=new Array();
                var i=1;
                var j=1;
                var k=1;
                var sL=0;
                var gN=0;
                var maSP='';
                var tongTien=0;

                var sD = $('#tbSanPham > tbody > tr').length;
                var temp = '<tr class="price">';                
                $("#tbNhapHang tbody tr").each(function()
                {
                    var timSoLuong=$(this).find(".soLuong");
                    var timGiaNhap=$(this).find(".giaNhap");
                    var timMaSanPham=$(this).find(".maSanPham");
                    timSoLuong.each(function(){                        
                        sL=parseInt($(this).html());                        
                    });
                    timGiaNhap.each(function(){
                        gN=parseInt($(this).html());                        
                    });
                    timMaSanPham.each(function(){                        
                        maSP=$(this).html();                        
                    });
                    soLuong[k]=sL;
                    donGia[k]=gN;
                    thanhTien[k]=sL*gN;
                    maSanPham[k]=maSP;
                    //alert(maSanPham[k].toString());
                    k++;
                });
                //------------------------------------------------
                $("#tbNhapHang tbody tr td").each(function()
                {
                    var t=$(this).html();
                    var c= parseInt(i%5);
                    if(c==1)
                    {
                        temp = temp +'<td style="text-align: center;">'+j+'</td>';
                    }                   
                    if(c!=0)                    
                    {
                        if(c==2||c==3||c==4)
                        {                            
                             if(c==2)
                             {
                                temp= temp+
                                '<td style="text-align: right;">'+$(this).html()+'</td>';
                             }
                             if(c==3)
                             {
                                temp= temp+
                                '<td style="text-align: right;">'+formatNumber(soLuong[j])+'</td>';
                             }
                             if(c==4)
                             {
                                temp= temp+
                                '<td style="text-align: right;">'+formatNumber(donGia[j])+'</td>';
                             }                             
                        }
                        else
                        {
                            temp= temp+
                             '<td>'+$(this).html()+'</td>';
                        }

                        if(c==1)
                        {
                            temp=temp+
                            '<td style="text-align: right;">'+maSanPham[j]+'</td>';
                        }
                        if(c==2)
                        {
                            temp=temp+'<td></td>';
                        }                            
                        if(c==4)
                        {
                            temp=temp+'<td style="text-align: right;"><span class="thanhTien">'+formatNumber(thanhTien[j])+'</span</td>';
                            tongTien=tongTien+parseInt(thanhTien[j]);
                        }
                    }
                    if(c==0)
                    {
                        temp=temp+'</tr>';                        
                        j++;                        
                    }                    
                    i++;
                });

                temp=temp+'<tr><td></td><td style="text-align: center;">TỔNG</td><td></td><td></td><td></td><td></td><td></td><td style="text-align: right;">'+formatNumber(tongTien)+'</td></tr>';
                //------------------------------------------------
                temp = temp.replace(/__index__/g, sD);                    
                $('#tbSanPham tbody').append(temp);
                var soTienBangChu=docso(tongTien);                                
                $('#tongSoTien').text(soTienBangChu);
                
                window.print();
                document.getElementById('formNhapHang').submit();
                return true;                
            }                
        }
    </script>